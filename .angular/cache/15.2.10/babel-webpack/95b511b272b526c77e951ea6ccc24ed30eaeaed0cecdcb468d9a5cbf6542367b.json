{"ast":null,"code":"import { Order } from '../models/order.model';\nimport { API_URL } from 'src/environment/environment';\nimport { HttpHeaders } from '@angular/common/http';\nimport { catchError, map, of } from 'rxjs';\nimport { Role } from '../models/role.model';\nimport { OrderDetail } from '../models/orderDetail.model';\nimport { User } from '../models/user.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"src/app/services/auth.service\";\nexport class OrderService {\n  constructor(http, authService) {\n    this.http = http;\n    this.authService = authService;\n    this.user_orders = [];\n    this.user_id = JSON.parse(localStorage.getItem('user')).id;\n    this.user_token = this.authService.getToken();\n  }\n  getOrderÉ() {\n    const headers = new HttpHeaders().set('Authorization', `Bearer ${this.user_token}`);\n    return this.http.get(API_URL + '/users', {\n      headers\n    }).subscribe(data => {\n      console.log(data);\n      this.sendOrder(data);\n    });\n  }\n  sendOrder(data) {\n    this.productsSubject.next(data);\n  }\n  getOrder() {\n    const headers = new HttpHeaders().set('Authorization', `Bearer ${this.user_token}`);\n    return this.http.get(`${API_URL}/users/${this.user_id}`, {\n      headers\n    }).pipe(map(data => {\n      var user = data;\n      console.log(user);\n      var orders = data.orders;\n      console.log(orders);\n      var orderDetails = orders.orderDetails;\n      console.log(orderDetails);\n      var roles = data.roles;\n      console.log(roles);\n      new Role(roles.id, roles.name);\n      new OrderDetail(orderDetails.id, orderDetails.quantity, orderDetails.price, orderDetails.product);\n      new Order(orders.id, orders.price, orders.status, orders.orderDetails);\n      new User(user.id, user.email, user.username, user.role, user.orders);\n      // const newOrder = new Order(\n      //   data.orders.id,\n      //   data.orders.price,\n      //   data.orders.status,\n      //   data.orders.orderDetails\n      // );\n      // this.user_orders.push(newOrder);\n      return this.user_orders; // Vous pouvez ajuster cela en fonction de votre logique\n    }), catchError(error => {\n      console.error('Erreur lors de la récupération des commandes :', error);\n      return of([]); // Renvoie un tableau vide en cas d'erreur\n    }));\n  }\n  static #_ = this.ɵfac = function OrderService_Factory(t) {\n    return new (t || OrderService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AuthService));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: OrderService,\n    factory: OrderService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"mappings":"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","names":["Order","API_URL","HttpHeaders","catchError","map","of","Role","OrderDetail","User","OrderService","constructor","http","authService","user_id","JSON","parse","localStorage","getItem","id","user_token","getToken","getOrderÉ","headers","set","get","subscribe","data","console","log","sendOrder","productsSubject","next","getOrder","pipe","user","orders","orderDetails","roles","name","quantity","price","product","status","email","username","role","user_orders","error","factory","providedIn"],"sourceRoot":"","sources":["/Users/leoterras/Desktop/ApiMaven/ApiMaven-FrontEnd/src/app/services/order.service.ts"],"sourcesContent":["import { AuthService } from 'src/app/services/auth.service';\nimport { Injectable } from '@angular/core';\nimport { Order } from '../models/order.model';\nimport { API_URL } from 'src/environment/environment';\nimport { HttpClient, HttpHeaders, HttpClientModule } from '@angular/common/http';\nimport { Observable, catchError, map, of } from 'rxjs';\nimport { Role } from '../models/role.model';\nimport { OrderDetail } from '../models/orderDetail.model';\nimport { User } from '../models/user.model';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OrderService {\n  user_id: number;\n  user_token: string;\n  user_orders: Order[] = [];\n  productsSubject: any;\n\n  constructor(\n    private http: HttpClient,\n    private authService: AuthService\n  ) {\n    this.user_id = JSON.parse(localStorage.getItem('user') as string).id;\n    this.user_token = this.authService.getToken() as string;\n  }\n\n  getOrderÉ(): any {\n    const headers = new HttpHeaders().set('Authorization', `Bearer ${this.user_token}`);\n    return this.http.get(API_URL + '/users', { headers }).subscribe((data) => {\n      console.log(data);\n      this.sendOrder(data);\n    });\n  }\n\n  sendOrder(data: any) {\n    this.productsSubject.next(data);\n  }\n\n  getOrder(): Observable<Order[]> {\n    const headers = new HttpHeaders().set('Authorization', `Bearer ${this.user_token}`);\n    return this.http.get(`${API_URL}/users/${this.user_id}`, { headers }).pipe(\n      map((data: any) => {\n        var user = data;\n        console.log(user);\n\n        var orders = data.orders;\n        console.log(orders);\n\n        var orderDetails = orders.orderDetails;\n        console.log(orderDetails);\n\n        var roles = data.roles;\n        console.log(roles);\n\n        new Role(\n          roles.id,\n          roles.name\n        )\n\n        new OrderDetail(\n          orderDetails.id,\n          orderDetails.quantity,\n          orderDetails.price,\n          orderDetails.product\n        )\n\n        new Order(\n          orders.id,\n          orders.price,\n          orders.status,\n          orders.orderDetails\n        )\n\n        new User(\n          user.id,\n          user.email,\n          user.username,\n          user.role,\n          user.orders\n        )\n\n        // const newOrder = new Order(\n        //   data.orders.id,\n        //   data.orders.price,\n        //   data.orders.status,\n        //   data.orders.orderDetails\n        // );\n\n        // this.user_orders.push(newOrder);\n\n        return this.user_orders; // Vous pouvez ajuster cela en fonction de votre logique\n      }),\n      catchError((error: any) => {\n        console.error('Erreur lors de la récupération des commandes :', error);\n        return of([]); // Renvoie un tableau vide en cas d'erreur\n      })\n    );\n  }\n\n  // getOrders(): Order[] {\n  //   console.log(this.user_id);\n  //   const headers = new HttpHeaders().set('Authorization', `Bearer ${this.user_token}`);\n  //   this.http.get(`${API_URL}/users/${this.user_id}`, { headers }).subscribe(\n  //     (data: any) => {\n  //       console.log(data);\n\n  //       this.user_orders.push(new Order(\n  //         data.id,\n  //         data.price,\n  //         data.status,\n  //         data.orderDetails\n  //       ));\n  //     }\n  //   )\n\n  //   console.log(this.user_orders);\n\n  //   return this.user_orders;\n  // }\n\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}